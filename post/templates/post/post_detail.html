{%extends 'index.html' %}
{% load staticfiles %}
{% block title %}Post details{% endblock title %}
{% block status %}{{ status }}{% endblock %}
{% block error %}{{ message }}{% endblock %}
{% block main %}
<div class="container-fluid row ">
     <div class="col-md-8">
        <div class="card display-4 font-weight-normal text-justify" style="font-size: large">
            <div class="card-header bg-secondary text-white ">
                <h1 class=" text text-center display-4 font-italic " style="color:font-size: xx-large">
                    {{ post.title }}</h1>
            </div>
            <div class="col-sm-12" style="font-size: x-large">
                <p  class="text text-muted text-center font-italic pt-1">
                    By <span><a class="card-link" href="{% url 'profile' post.author_id %}">
                    {{ post.author_detail.first_name }} {{ post.author_detail.last_name }}</a></span> on {{ post.date_posted }}
            </p>
                <hr/>
            </div>
             <div class="card-body p-0">
                 {% if post.image.url != None %}
	      	        <main>
                        <img src="{{ post.image.url }}" class="img-responsive mb-2 card-image" width="100%" height=50%"/>
                    </main>
                 {% endif %}
	      <p class="text text-justify p-3 card-text">{{ post.content }}</p>
             {% if post.attachments.count > 0 %}
                 <div class="card-footer">
                 <p><strong>Attachments: </strong>{% for attachment in post.attachments %}<span class="ml-3">
                 <a  class="card-link" href="{{ attachment.file.url }}"> {{ attachment.file.name }} </a></span>{% endfor %}</p>
                </div>
             {% endif %}
                 {% if user.is_authenticated %}
                     {%if post.for_cooperative == True and user.is_cooperative_member or post.for_cooperative == False %}
          <div class="card-link card-footer bg-light p-2">
            <a  href="#" class="card-link mr-1">
                <i class="fa fa-comment"></i>
                <span class="share1 fb">Comment  {{ post.all_comments.count }}</span>
            </a>
                                <a href="javascript:{
                $.ajax({
                    type: 'GET',
                    url: '{% url 'react' %}',
                    data: { message_type  : 'Post', 'message_id' : {{ post.id }} , reaction : 'L' },
                    success: function() {
                    const a = document.getElementById('l_share_{{ post.id }}');
                    const d = document.getElementById('d_share_{{ post.id }}');
                    const b = document.getElementById('like_count_{{post.id }}');
                    const c = document.getElementById('dislike_count_{{post.id }}');
                    if (a.innerText === 'Like' && d.innerText === 'Disliked'){
                        b.innerText = Number(b.innerText) + 1;
                        c.innerText = Number(c.innerText) - 1;
                        a.innerText='Liked';
                        d.innerText='Dislike';
                    }else if (a.innerText === 'Like' && d.innerText === 'Dislike'){
                        b.innerText = Number(b.innerText) + 1;
                        a.innerText='Liked';
                    }
                    }
                    });
                    }" id="like_btn" class="btn mr-1" >
                                    <i class="fa fa-thumbs-up tw"></i>
                                    <span id="l_share_{{ post.id }}">{% if user in post.likes %}Liked{% else %}Like{% endif %} <a id="like_count_{{ post.id }}" href="{% url 'likes' 'Post' post.id %}"> {{ post.likes_ }}</a></span>
                                </a>
                                <a  href="javascript:{
                $.ajax({
                    type: 'GET',
                    url: '{% url 'react'  %}',
                    data: { message_type  : 'Post', 'message_id' : {{ post.id }} , reaction : 'D' },
                    success: function() {
                    const a = document.getElementById('l_share_{{ post.id }}');
                    const d = document.getElementById('d_share_{{ post.id }}');
                    const b = document.getElementById('like_count_{{post.id }}');
                    const c = document.getElementById('dislike_count_{{post.id }}');
                    if (a.innerText === 'Liked' && d.innerText === 'Dislike'){
                        b.innerText = Number(b.innerText) - 1;
                        c.innerText = Number(c.innerText) + 1;
                        a.innerText='Like';
                        d.innerText='Disliked';
                    }else if (a.innerText === 'Like' && d.innerText === 'Dislike'){
                        c.innerText = Number(c.innerText) + 1;
                        d.innerText='Disliked';
                    }
                    }
                    });
                }" class="btn mr-1" >
                                    <i class="fa fa-thumbs-down tw"></i>
                                    <span id="d_share_{{ post.id }}">{% if user in post.dislikes %} Disliked {% else %}Dislike{% endif %}  <a id="dislike_count_{{ post.id }}" href="{% url 'dislikes' 'Post' post.id %}" >
                                        {{ post.dislikes_ }}</a></span>
                                </a>
            </div>
             {% endif %}
             {% endif %}
	      </div>
             </div>
                {% if post.video.url != none %}
                <div  id="post_media" class="row container center-block bg-light mb-3">
                 <div class="col-sm-12 ">
                 <p class="text text-center display-4" style="font-size: x-large">Watch the video here</p>
                   <iframe
                           width="480" height="270" src="{{ post.video }}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                 </div>
                </div>
                {% endif %}
                 {% if post.audio.url != none %}
                     <div class="row center-block">
                        <div class="col-sm-12 mt-2">
                     <p class="text text-center display-4" style="font-size: x-large">Listen to the Audio here</p>
                      <audio  class="container center-block" src="{% static '{{ post.audio.url }}' %}" controls="controls" type="MIME_type"></audio>
                </div>
                     </div>
                 {% endif %}
          <div  id="post_comments" class="display-4 font-weight-normal" style="font-size: large">
          <div class="card-header card-title bg-secondary text-white text text-center mt-3 mb-4"><p style="font-size: xx-large">All Comments </p></div>
            {% if post.all_comments.count > 0 and post.for_cooperative == True and user.is_cooperative_member or post.for_cooperative == False %}
              {% for comment in post.all_comments %}
                <div class="row mb-3 display-4 font-weight-normal text-justify" style="font-size: large">
                <div class="col-sm-2 text-center bg-secondary text-white p-2">
                    <div class="thumbnail mt-3">
                        <img class="img-responsive rounded-circle"
                             src="{% if comment.author_detail.image.url != '/media/' %}{{ comment.author_detail.image.url }}
                            {% else %}{% static 'seek/images/profile.png' %}{% endif %}" height="70" width="70" >
                    </div>
                    <div class="card-header bg-transparent mt-0">
                      <a style="color: #546c8a" class="card-link text-white" href="{% url 'profile' comment.author_id %}">{{ comment.author_detail.username }}</a>
                    </div>

                </div>
                <div class="card col-sm-10 display-4 font-weight-normal text-justify pl-0 pr-0" style="font-size: large">
                    <div class="card-header card-title bg-secondary text-white p-2">
                        <p> Commented on {{ comment.date_posted }}</p>
                    </div>
                    <div class="card-body">
                        {{ comment.content }}
                    </div>
                    <div class="card-footer p-0">
                        {%  if user.is_authenticated and user.is_cooperative_member  or user.is_partner %}
                            {% if post.for_cooperative == True and user.is_cooperative_member or post.for_cooperative == False %}
                        <div class="card-link bg-light p-2">
                                <a class="btn mr-1" href="{% url 'comment_detail' post.id comment.id %}">
                                    <i class="fa fa-comment"></i>
                                    <span class="share1 fb">Reply {{ comment.all_replies.count }}</span>
                                </a>
                                <a href="javascript:{
                $.ajax({
                    type: 'GET',
                    url: '{% url 'react'  %}',
                    data: { message_type  : 'Comment', 'message_id' : {{ comment.id }} , reaction : 'L' },
                    success: function() {
                    const a = document.getElementById('l_c_share_{{ comment.id }}');
                    const d = document.getElementById('d_c_share_{{ comment.id }}');
                    const b = document.getElementById('comment_like_count_{{comment.id }}');
                    const c = document.getElementById('comment_dislike_count_{{comment.id }}');
                    if (a.innerText === 'Like' && d.innerText === 'Disliked'){
                        b.innerText = Number(b.innerText) + 1;
                        c.innerText = Number(c.innerText) - 1;
                        a.innerText='Liked';
                        d.innerText='Dislike';
                    }else if (a.innerText === 'Like' && d.innerText === 'Dislike'){
                        b.innerText = Number(b.innerText) + 1;
                        a.innerText='Liked';
                    }
                    }
                    });
                    }" id="like_btn" class="btn mr-1" >
                                    <i class="fa fa-thumbs-up tw"></i>
                                    <span id="l_c_share_{{ comment.id }}">{%if user in comment.likes %} Liked {% else %}Like{% endif %} <a id="comment_like_count_{{ comment.id }}" href="{% url 'likes' 'Comment' comment.id %}"> {{ comment.likes_ }}</a></span>
                                </a>
                                <a  href="javascript:{
                $.ajax({
                    type: 'GET',
                    url: '{% url 'react' %}',
                    data: { message_type  : 'Comment', 'message_id' : {{ comment.id }} , reaction : 'D' },
                    success: function() {
                    const a = document.getElementById('l_c_share_{{ comment.id }}');
                    const d = document.getElementById('d_c_share_{{ comment.id }}');
                    const b = document.getElementById('comment_like_count_{{comment.id }}');
                    const c = document.getElementById('comment_dislike_count_{{comment.id }}');
                    if (a.innerText === 'Liked' && d.innerText === 'Dislike'){
                        b.innerText = Number(b.innerText) - 1;
                        c.innerText = Number(c.innerText) + 1;
                        a.innerText='Like';
                        d.innerText='Disliked';
                    }else if (a.innerText === 'Like' && d.innerText === 'Dislike'){
                        c.innerText = Number(b.innerText) + 1;
                        d.innerText='Disliked';
                    }
                    }
                    });
                    }" class="btn mr-1" >
                                    <i class="fa fa-thumbs-down tw"></i>
                                    <span id="d_c_share_{{ comment.id }}">{% if user in comment.dislikes %}Disliked {% else %}Dislike{% endif %}  <a  id="comment_dislike_count_{{ comment.id }}" href="{% url 'dislikes' 'Comment' comment.id %}" >
                                        {{ comment.dislikes_ }}</a></span>
                                </a>
                           </div>
                                {% endif %}
                    {% endif %}
                    </div>
                </div>
                </div>
            {% endfor %}
          {% endif %}
            <div class="col-sm-12 rounded mt-3">
             <form class="form" action="{% url 'post_detail' post.id %}" method="post">
                 {% csrf_token %}
		        <div class="input-group mb-3">
                    <textarea type="text" class="form-control text text-justify" name="content" placeholder="Type in your message"
                              aria-label="" aria-describedby="basic-addon1"></textarea>
                    <div class="input-group-append">
                     <input class="btn btn-outline-success btn-sm"
                            onclick=" document.getElementById('post_media').hidden = false;
                                  document.getElementById('post_comments').hidden =false;
                                " value='Send' type="submit">
                    </div>
                </div>
             </form>
            </div>
          </div>
		  </div>

     <div class="col-md-4 font-weight-normal">
	   	  <div class="col_8">
              <div class="col-sm-12 bg-secondary rounded-2 text-white">
                  <h3 class=" text text-center display-4 font-italic p-3 " style="font-size: xx-large" >Related Posts</h3>
              </div>
          {% if related.count == 0 %}
              <div class="col-sm-12">
                <p class="lead text text-center text-info pb-2">No Related Posts</p>
              </div>
          {% else %}
	   	  	<div class="list">
               {% for r_post in related %}
                    {% if r_post.id == post.id and related.count == 1 %}
	   	  		         <div class="col-sm-12">
                <p class="lead text text-center text-info pb-2">No Related Posts</p>
              </div>
                        {% else  %}
                            {% if r_post.id != post.id %}
                                <div class="card-header title bg-light shadow-lg mb-2 display-4" style="font-size: x-large">
                                <p><a class="card-link" href="{% url 'post_detail' r_post.id %}">{{ r_post.title }}</a></p>
                                </div>
                            {% endif %}
                        {% endif %}
	   	  	    {% endfor %}
            </ul>
         {% endif %}
	   	  </div>
	 </div>
</div>
{% endblock main %}
